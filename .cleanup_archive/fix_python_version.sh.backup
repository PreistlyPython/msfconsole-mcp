#!/bin/bash

# Fix script to use a compatible Python version

set -e

# Remove existing virtual environment
if [ -d "venv" ]; then
    echo "Removing existing virtual environment..."
    rm -rf venv
fi

# Try with Python 3.8 first
if command -v python3.8 &> /dev/null; then
    echo "Using Python 3.8 to create virtual environment..."
    python3.8 -m venv venv
elif command -v python3.9 &> /dev/null; then
    echo "Using Python 3.9 to create virtual environment..."
    python3.9 -m venv venv
elif command -v python3.10 &> /dev/null; then
    echo "Using Python 3.10 to create virtual environment..."
    python3.10 -m venv venv
elif command -v python3.11 &> /dev/null; then
    echo "Using Python 3.11 to create virtual environment..."
    python3.11 -m venv venv
else
    echo "Could not find compatible Python version. Please install Python 3.8 or 3.9."
    echo "On Ubuntu/Debian: sudo apt install python3.8 python3.8-venv"
    exit 1
fi

# Activate the virtual environment
source venv/bin/activate

echo "Python version: $(python --version)"

# Install dependencies
pip install --upgrade pip setuptools wheel
pip install "mcp[cli]>=0.1.0"
pip install -r requirements.txt

echo "Virtual environment setup complete!"
echo "Run: source venv/bin/activate"
echo "Then: python msfconsole_mcp.py"
